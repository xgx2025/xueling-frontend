# 实施计划: 用户认证系统

## 概述

本实施计划将用户认证功能分解为增量式的开发任务。每个任务都基于前一个任务构建，确保代码逐步集成。重点是核心功能实现，测试任务标记为可选以加快 MVP 开发。

## 任务列表

- [x] 1. 设置项目基础结构和工具函数
  - 创建 `src/utils/validators.ts` 文件，实现邮箱、密码、验证码验证函数
  - 创建 `src/utils/crypto.ts` 文件，实现密码加密函数（可选）
  - 创建 `src/types/auth.ts` 文件，定义认证相关的 TypeScript 类型
  - _需求: 1.1, 1.2, 1.3, 3.1, 3.2, 4.1, 4.2, 4.4_

- [x] 1.1 为验证工具函数编写属性测试

  - **属性 1: 邮箱格式验证一致性**
  - **验证需求: Requirements 1.1, 2.1, 3.1**


- [x] 1.2 为密码验证函数编写属性测试

  - **属性 2: 密码确认一致性**
  - **属性 4: 密码强度验证**
  - **验证需求: Requirements 1.2, 3.2, 4.1, 4.2**

- [x] 1.3 为密码加密函数编写属性测试

  - **属性 5: 密码加密不可逆性**
  - **验证需求: Requirements 4.4**

- [x] 1.4 为验证码验证函数编写属性测试

  - **属性 3: 验证码格式验证**
  - **验证需求: Requirements 1.3**

- [x] 2. 创建用户状态管理 Store
  - [x] 2.1 创建 `src/stores/user.ts`，实现 useUserStore
    - 定义用户信息状态
    - 实现 setUserInfo、clearUserInfo、logout 方法
    - 集成 useTokenStore 进行令牌管理
    - _需求: 6.1, 6.2, 6.5_

  - [x] 2.2 为 Store 编写属性测试

    - **属性 6: 令牌存储往返一致性**
    - **验证需求: Requirements 3.5, 6.2, 6.3**

- [x] 3. 实现 API 服务层
  - [x] 3.1 创建 `src/api/auth.ts`，实现认证 API 服务
    - 实现 login(email, password) 方法
    - 实现 register(email, password, confirmPassword, code) 方法
    - 实现 sendVerificationCode(email) 方法
    - 使用现有的 request.ts 实例
    - _需求: 8.1, 8.2, 8.3, 8.4_

  - [x] 3.2 为 API 服务编写单元测试

    - 测试 API 请求参数格式
    - 测试错误处理
    - _需求: 8.1, 8.2, 8.3, 8.4_

- [ ] 4. 检查点 - 确保基础设施完整
  - 确保所有测试通过，如有问题请询问用户。

- [x] 5. 实现登录页面组件
  - [x] 5.1 创建 `src/views/auth/LoginView.vue`
    - 使用 Element Plus 表单组件
    - 实现表单验证规则
    - 实现登录表单提交逻辑
    - 集成 authService 和 tokenStore
    - 登录成功后跳转到主页
    - 添加"前往注册"链接
    - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 5.1, 5.2, 5.3, 5.4, 5.5_

  - [x] 5.2 为登录组件编写单元测试

    - 测试表单验证
    - 测试登录成功流程
    - 测试登录失败处理
    - _需求: 3.1, 3.2, 3.3, 3.4_

- [x] 6. 实现注册页面组件
  - [x] 6.1 创建 `src/views/auth/RegisterView.vue`
    - 使用 Element Plus 表单组件
    - 实现表单验证规则（包括密码确认验证）
    - 实现验证码发送功能和倒计时
    - 实现注册表单提交逻辑
    - 集成 authService
    - 注册成功后跳转到登录页
    - 添加"前往登录"链接
    - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 2.1, 2.2, 2.3, 2.4, 4.1, 4.2, 4.3, 5.1, 5.2, 5.3, 5.4, 5.5_

  - [x] 6.2 为验证码倒计时编写属性测试

    - **属性 8: 验证码倒计时单调递减**
    - **验证需求: Requirements 2.3**

  - [ ]* 6.3 为注册组件编写单元测试
    - 测试表单验证
    - 测试验证码发送和倒计时
    - 测试注册成功流程
    - 测试注册失败处理
    - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6_

- [ ] 7. 配置路由
  - [ ] 7.1 更新 `src/router/index.ts`
    - 添加 /login 路由指向 LoginView
    - 添加 /register 路由指向 RegisterView
    - 添加 / 路由指向主页（占位符）
    - 实现路由守卫：未登录用户访问受保护路由时跳转到登录页
    - _需求: 3.6, 1.6, 6.4_

  - [ ]* 7.2 为路由守卫编写单元测试
    - 测试未登录用户重定向
    - 测试已登录用户正常访问
    - _需求: 6.4_

- [x] 8. 更新主应用入口
  - [x] 8.1 更新 `src/App.vue`
    - 添加 `<router-view>` 以显示路由组件
    - 移除占位内容
    - 添加全局样式（可选）
    - _需求: 所有_

  - [x] 8.2 更新 `src/main.ts`
    - 确保 Element Plus 正确导入和配置
    - 添加全局错误处理（可选）
    - _需求: 所有_

- [ ] 9. 验证请求拦截器
  - [x] 9.1 为请求拦截器编写属性测试

    - **属性 9: 请求拦截器认证头一致性**
    - **验证需求: Requirements 8.5**

  - [x] 9.2 为表单验证编写属性测试

    - **属性 7: 表单验证反馈一致性**
    - **验证需求: Requirements 5.1, 5.5**

- [x] 10. 样式和响应式优化
  - [x] 10.1 优化登录和注册页面样式
    - 实现居中布局
    - 添加响应式设计（移动端、平板、桌面）
    - 优化表单间距和视觉效果
    - 添加品牌元素（Logo、标题等）
    - _需求: 7.1, 7.2, 7.3, 7.4_

- [ ] 11. 最终检查点 - 完整功能测试
  - 手动测试完整的注册流程
  - 手动测试完整的登录流程
  - 测试 Token 刷新机制
  - 测试会话恢复（刷新页面）
  - 测试响应式布局
  - 确保所有自动化测试通过
  - 如有问题请询问用户

## 注意事项

- 标记为 `*` 的任务是可选的，可以跳过以加快 MVP 开发
- 每个任务都引用了具体的需求编号以便追溯
- 检查点任务确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证具体示例和边缘情况
